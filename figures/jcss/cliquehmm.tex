\documentclass[11pt]{article}
\input shared.texm
\def\graybg{lightgray}

%circle of a given color with text
\def\NODE(#1,#2)#3#4#5{%
\cnode[fillstyle=solid,fillcolor=#4](#1,#2){0.23}{#3}\rput(#1,#2){#5}}%
%silen state
\def\SNODE(#1,#2)#3#4{%
\cnode[fillstyle=solid,fillcolor=#4](#1,#2){0.1}{#3}}%

\def\BNODE(#1,#2)#3#4#5{%
\fnode[linecolor=#4,fillstyle=solid,fillcolor=#4,framesize=0.5](#1,#2){#3}\rput(#1,#2){#5}}%

%centered text in a box of given size
\def\centeredtext#1#2{%
\begin{minipage}{#1}\begin{centering}%
#2%
\end{centering}\end{minipage}}

\startfile
\psset{unit=1.5cm}%
\psset{linewidth=0.7pt}%
\psset{arrowsize=1.8pt 4}%
\begin{pspicture}(-4,-2)(4.2,0.5)
\psset{arrows=->}
\def\xa{1.1}
\def\xb{2.2}
\def\xc{3.3}
\def\xd{4}

\NODE(-4,0){start}{white}{$S$}
\BNODE(-4,-0.85){estart}{white}{$\Sigma-\{T\}$}
\ncline{start}{estart}

\NODE(4,0){final}{white}{$T$}
\BNODE(4,-0.85){efinal}{white}{$\Sigma-\{S\}$}
\ncline{final}{efinal}

\NODE(3,-1){error}{white}{$E$}
\BNODE(3,-1.85){eerror}{white}{$\{S\}$}i
\ncline{error}{eerror}

\NODE(-2,0){bstart}{white}{$S'$}
\BNODE(-2,-0.85){ebstart}{white}{$\{S'\}$}
\ncline{bstart}{ebstart}

\NODE(2,0){bfinal}{white}{$T'$}
\BNODE(2,-0.85){ebfinal}{white}{$\{T'\}$}
\ncline{bfinal}{ebfinal}

\NODE(0,0){hash}{white}{$\#$}
\BNODE(0,-0.85){ehash}{white}{$\{\#\}$}
\ncline{hash}{ehash}


\ncline{start}{bstart}
\ncline{bstart}{hash}
\ncline{hash}{bfinal}
\ncline{bfinal}{final}

\nccircle[angle=0]{start}{0.23}\bput[0.02]{0}{}
\nccircle[angle=0]{final}{0.23}\bput[0.02]{0}{}

\NODE(-1,-1){0}{white}{$0$}
\BNODE(-1,-1.85){e0}{white}{$\{0,?\}$}
\ncline{0}{e0}

\NODE(1,-1){1}{white}{$1$}
\BNODE(1,-1.85){e1}{white}{$\{1,?\}$}
\ncline{1}{e1}


\ncline{hash}{0}
\ncline{0}{hash}
\ncline{hash}{1}
\ncline{1}{hash}

\ncline{final}{error}

\end{pspicture}
\endfile

